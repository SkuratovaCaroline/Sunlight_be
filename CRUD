--CREATE


-- Создание пользователя
INSERT INTO "user" (u_id, u_name, u_surname, u_email, u_password) 
VALUES (11, 'ivanov', 'Иван', 'ivan@mail.ru', 'pass123');

-- Создание локации
INSERT INTO locations (l_id, l_name, l_address) 
VALUES (41, 'ТРЦ Галерея', 'ул. Центральная 1');

-- Создание зала
INSERT INTO halls (h_id, h_name, l_id) 
VALUES (31, 'Красный зал', 41);

-- Создание фильма
INSERT INTO film (f_id, f_title, f_about, f_time, f_age_limit, f_release, f_end_date) 
VALUES (21, 'Интерстеллар', 'Фантастика о космосе', 169, '12+', '2014-11-01', '2015-01-01');

-- Создание сеанса
INSERT INTO sessions (s_id, f_id, h_id, s_start_timestamp, s_end_timestamp, s_price) 
VALUES (51, 21, 31, '2024-01-15 18:00:00', '2024-01-15 21:00:00', 350);

-- Создание места
INSERT INTO seats (st_id, h_id, seat_row, seat_num, seat_type) 
VALUES (71, 31, 1, 1, 'standard');

-- Создание билета
INSERT INTO tickets (t_id, u_id, s_id, t_price, t_date, t_code, t_status) 
VALUES (61, 11, 51, 350, '2024-01-15', 'QR123456', 'куплено');

-- Создание оценки
INSERT INTO ratings (r_id, u_id, f_id, rating) 
VALUES (81, 11, 21, 9);

-- Создание отзыва
INSERT INTO reviews (rv_id, u_id, f_id, rv_text, rv_date, rv_approved)
VALUES (91, 11, 21, 'Отличный фильм!', '2024-01-15', 'Y');


--READ
-- Все пользователи
SELECT * FROM "user";

-- Пользователь по ID
SELECT * FROM "user" WHERE u_id = 11;

-- Пользователь по email
SELECT * FROM "user" WHERE u_email = 'ivan@mail.ru';

-- Фильмы с рейтингом выше 8
SELECT f.* FROM film f
JOIN ratings r ON f.f_id = r.f_id
WHERE r.rating > 8;

-- Сеансы на сегодня
SELECT * FROM sessions WHERE DATE(s_start_timestamp) = CURRENT_DATE;

-- Свободные места на сеанс
SELECT s.* FROM seats s 
WHERE s.h_id = 31 
AND s.st_id NOT IN (
    SELECT t.st_id FROM tickets t
    WHERE t.s_id = 51 AND t.t_status = 'куплено'
);

-- Билеты пользователя
SELECT t.*, f.f_title, s.s_start_timestamp, h.h_name
FROM tickets t
JOIN sessions s ON t.s_id = s.s_id
JOIN film f ON s.f_id = f.f_id
JOIN halls h ON s.h_id = h.h_id
WHERE t.u_id = 11;

-- Отзывы к фильму
SELECT r.*, u.u_name
FROM reviews r
JOIN "user" u ON r.u_id = u.u_id
WHERE r.f_id = 21 AND r.rv_approved = 'Y';

--UPDATE

-- Обновление данных пользователя
-- Обновление имени и email пользователя
UPDATE "user" 
SET u_name = 'new_username', u_email = 'new@mail.ru' 
WHERE u_id = 11;

-- Обновление пароля
UPDATE "user" 
SET u_password = 'newpassword' 
WHERE u_id = 11;

-- Обновление цены билета
UPDATE tickets 
SET t_price = 400 
WHERE t_id = 61;

-- Обновление статуса билета
UPDATE tickets 
SET t_status = 'зарезервировано' 
WHERE t_id = 61;

-- Обновление рейтинга фильма
UPDATE ratings 
SET rating = 8 
WHERE r_id = 81;

-- Обновление статуса отзыва
UPDATE reviews 
SET rv_approved = 'Y' 
WHERE rv_id = 91;

-- Обновление информации о зале
UPDATE halls 
SET h_name = 'Обновленный зал' 
WHERE h_id = 31;


--DELETE

-- Удаление пользователя
DELETE FROM "user" WHERE u_id = 11;

-- Удаление билета
DELETE FROM tickets WHERE t_id = 61;

-- Удаление отзыва
DELETE FROM reviews WHERE rv_id = 91;

-- Удаление оценки
DELETE FROM ratings WHERE r_id = 81;

-- Удаление сеанса
DELETE FROM sessions WHERE s_id = 51;

-- Удаление фильма
DELETE FROM film WHERE f_id = 21;

-- Удаление зала
DELETE FROM halls WHERE h_id = 31;

-- Удаление локации
DELETE FROM locations WHERE l_id = 41;
